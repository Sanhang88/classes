define("wiki-lemma:widget/lemma_content/configModule/secondsKnow/secondsKnow",function(e,a,i){var n=e("wiki-common:widget/lib/jquery/jquery"),t=e("wiki-common:widget/lib/jsmart/jsmart"),o=e("wiki-common:widget/ui/dialog/dialog"),s=e("wiki-common:widget/ui/videoPlayer/videoPlayer"),l=e("wiki-common:widget/ui/bubble/bubble"),d=e("wiki-common:widget/component/share/share"),c=e("wiki-lemma:widget/tools/newSideShare/qrcode"),r=e("wiki-common:widget/component/nslog/nslog"),m=e("wiki-common:widget/util/browser"),g=e("wiki-common:widget/util/url"),p=(e("wiki-common:widget/lib/swfObject/swfObject"),'<div class="lemmaWgt-secondsKnow-dialog-content" {%if $videoSrcList|count > 1%}style="width: 900px"{%/if%} data-shareSrc="{%$videoSrcList[0].videoSrc.cover_small|wiki_common_https_trans|f_escape_xml%}">\n<div class="dialog-player">\n<div class="player-container"></div>\n<div class="player-bar">\n<span class="bar-title"></span>\n<span class="bar-vv"><em class="wiki-lemma-icons wiki-lemma-icons_eye"></em><span class="bar-vv-num"></span></span>\n<a class="share-btn" nslog-type="10002510">\n<em class="cmn-icon cmn-icons cmn-icons_share"></em>\n</a>\n</div>\n</div>\n<div class="dialog-list" {%if $videoSrcList|count <= 1%}style="display:none"{%/if%}>\n<div class="list-title">更多视频&nbsp;<span>{%$videoSrcList|count|f_escape_xml%}个</span></div>\n<ul class="list-gallery">\n{%foreach $videoSrcList as $i => $video%}\n<li data-mediaId="{%$video.mediaId|f_escape_xml%}" class="J-list-gallery-li" data-secondId="{%$video.secondId|f_escape_xml%}">\n<a href="javascript:;" nslog-type="10002504">\n<img src="{%$video.videoSrc.cover_small|wiki_common_https_trans|f_escape_xml%}" />\n<span class="video-shadow">正在播放</span>\n<span class="video-pv"></span>\n</a>\n<div title="{%$video.title|f_escape_xml%}" class="video-title">{%$video.title|f_escape_xml%}</div>\n</li>\n{%/foreach%}\n</ul>\n</div>\n</div>\n'),w='<li class="bubble-content">\n<a href="javascript:;" nslog-type="10002511" data-channel="wechat"><em class="cmn-icon cmn-icons cmn-icons_logo-wechat"></em></a>\n<a href="javascript:;" nslog-type="10002512" data-channel="qzone"><em class="cmn-icon cmn-icons cmn-icons_logo-qzone"></em></a>\n<a href="javascript:;" nslog-type="10002513" data-channel="qq"><em class="cmn-icon cmn-icons cmn-icons_logo-qq"></em></a>\n<a href="javascript:;" nslog-type="10002514" data-channel="weibo"><em class="cmn-icon cmn-icons cmn-icons_logo-sina-weibo"></em></a>\n</li>';i.exports=function(a,i,v){function y(){I instanceof o&&I.hide()}function h(e){var a=27;(e.keyCode===a||e.which===a)&&y()}function u(e,a){var i=0;if(n.each(f,function(a,n){n.mediaId==e&&(i=a)}),"letvPlayer"===f[i].videoSrc.type)return void window.open(f[i].playUrl);I.show(),"baikePlayer"===f[i].videoSrc.type?k.show():k.hide(),b&&"function"==typeof b.destroy&&b.destroy(),b=new s(".lemmaWgt-secondsKnow-dialog .player-container",f[i].videoSrc,{width:685,height:390}),n.getJSON("/wikisecond/viewnum?type=set&secondId="+a+"&mediaId="+e+"&secondKind="+f[i].videoSrc.secondKind);var t=n('.lemmaWgt-secondsKnow-dialog li[data-mediaId="'+e+'"]');t.addClass("play").siblings().removeClass("play"),n(".lemmaWgt-secondsKnow-dialog .bar-title").text(f[i].title).attr("title",f[i].title),n(".bar-vv-num").text(t.attr("data-playNum"))}var f=a.secondsKnow;r({type:10002501,lemmaTitle:v,newLemmaId:i});var b,I;I=new o({classNames:"lemmaWgt-secondsKnow-dialog",hasCloseBtn:!0,content:new t(p).fetch({videoSrcList:f}),onShow:function(){n("body").on("keydown",h)},onHide:function(){r(10002503),n("body").off("keydown",h),b&&"function"==typeof b.destroy&&b.destroy()}});var k=n(".lemmaWgt-secondsKnow-dialog .share-btn"),_=new l({host:k,content:w,classNames:"lemmaWgt-secondsKnow-dialog-bubble",marginFromHost:15,pos:"leftAuto",showTail:!0,hideWhenBlur:!0,animation:"SLIDE"});k.on("click",function(){_.show()}),n(_.getNode()).on("click",'a:not([data-channel="wechat"])',function(){var e=n(this).attr("data-channel"),a=n(".J-list-gallery-li.play").index()>-1?n(".J-list-gallery-li.play").index():0,t=n(".J-list-gallery-li").eq(a),o=t.attr("data-secondId");n.get("/api/wikisecond/sharenum?secondId="+o),d.openShareLink(e,{url:window.location.origin+"/wikisecond/videoflow?lemmaId="+i+"&secondId="+o,title:"快速了解"+n("title").text().split("_")[0]+"，就在百科秒懂视频！",pic:n(".J-list-gallery-li.play img").attr("src")})});var S=new l({host:n(_.getNode()).find('[data-channel="wechat"]'),content:'<div class="bubble-content"></div>',classNames:"lemmaWgt-secondsKnow-dialog-qrcode-bubble",marginFromHost:15,pos:"topAuto",showTail:!0,hideWhenBlur:!0,animation:"SLIDE"});n(_.getNode()).on("click",'a[data-channel="wechat"]',function(){var e=new c(n(S.getNode()).find("div").get(0),{width:180,height:180}),a=n(".J-list-gallery-li.play").index()>-1?n(".J-list-gallery-li.play").index():0,t=n(".J-list-gallery-li").eq(a);e.makeCode("https://baike.baidu.com/wikisecond/videoflow?lemmaId="+i+"&secondId="+t.attr("data-secondId")),S.show()}),(!m.ie()||m.ie()>8)&&e.async(["wiki-lemma:widget/lemma_content/configModule/secondsKnow/perfect-scrollbar/index"],function(e){f.length>1&&e.initialize(n(".lemmaWgt-secondsKnow-dialog .list-gallery").get(0),{wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20,stopPropagationOnClick:!1})}),n(".lemmaWgt-secondsKnow-dialog .list-gallery").on("click","li:not(.play)",function(){u(n(this).attr("data-mediaId"),n(this).attr("data-secondId"))}),n("#lemmaWgt-secondsKnow .lemmaWgt-secondsKnow-gallery").on("click","li",function(){u(n(this).attr("data-mediaId"),n(this).attr("data-secondId"))}),n.ajax({type:"GET",url:"/api/wikisecond/modulemedialistsort",data:{lemmaId:i},dataType:"json",success:function(e){var i=n(".lemmaWgt-secondsKnow-gallery li"),t=n(".dialog-list .list-gallery li");e&&n.isArray(e.sort)&&(n.each(e.sort,function(e,a){var n=a.playNum;if(parseInt(n,10)>=1e4){if(n=parseInt(n,10)/1e4,n.toString().indexOf(".")>-1){var o=n.toString();n=o.substr(0,o.indexOf(".")+2)}n+="w"}i.filter("[data-secondId="+a.secondId+"]").attr("data-position",e).attr("data-playNum",a.playNum).find(".video-title-vv").append(n),t.filter("[data-secondId="+a.secondId+"]").attr("data-position",e).attr("data-playNum",a.playNum)}),i.sort(function(e,a){return parseInt(n(e).attr("data-position"),10)-parseInt(n(a).attr("data-position"),10)}),t.sort(function(e,a){return parseInt(n(e).attr("data-position"),10)-parseInt(n(a).attr("data-position"),10)}));var o=n(".lemmaWgt-secondsKnow-gallery");o.html(i);var s=3;"largeFeature"===a.type&&(s=2),"pageBg"===a.type&&(s=1),o.children().length>s&&o.find("li:gt("+(s-1)+")").remove(),o.css("opacity",1),n(".dialog-list .list-gallery").html(t)},error:function(){n(".lemmaWgt-secondsKnow-gallery").css("opacity",1)},complete:function(){var e=g.getQuery("secondId");if(e){var a=n('.J-list-gallery-li[data-secondId="'+e+'"]').get(0);if(a){var i=a.getAttribute("data-mediaId");i&&u(i,e)}}}})}});